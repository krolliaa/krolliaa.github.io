<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>RabbitMQ Study [未完结] | Krolliaa</title><meta name="keywords" content="微服务,消息队列"><meta name="author" content="Krolliaa"><meta name="copyright" content="Krolliaa"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="消息中间件是什么？消息队列就是消息中间件，消息很好理解你可以理解为信息，那中间件呢？中间件是提供软件和软件之间连接的软件，以便于软件各个部件之间的沟通。在咖啡店买咖啡这个例子中，微信就是消息中间件。发送方和接收方就是被消息中间件连接的 为什么要使用消息中间件呢？同步直接调用 —&gt; 异步直接调用 —&gt; 消息中间件 先来理解下什么是同步直接调用？请看下图：   可以看到同步直接调用的整个业">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMQ Study [未完结]">
<meta property="og:url" content="http://example.com/2022/08/12/RabbitMQStudy/index.html">
<meta property="og:site_name" content="Krolliaa">
<meta property="og:description" content="消息中间件是什么？消息队列就是消息中间件，消息很好理解你可以理解为信息，那中间件呢？中间件是提供软件和软件之间连接的软件，以便于软件各个部件之间的沟通。在咖啡店买咖啡这个例子中，微信就是消息中间件。发送方和接收方就是被消息中间件连接的 为什么要使用消息中间件呢？同步直接调用 —&gt; 异步直接调用 —&gt; 消息中间件 先来理解下什么是同步直接调用？请看下图：   可以看到同步直接调用的整个业">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/index_img/11.jpg">
<meta property="article:published_time" content="2022-08-12T08:45:54.288Z">
<meta property="article:modified_time" content="2022-08-12T08:56:57.609Z">
<meta property="article:author" content="Krolliaa">
<meta property="article:tag" content="微服务">
<meta property="article:tag" content="消息队列">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/index_img/11.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/08/12/RabbitMQStudy/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'RabbitMQ Study [未完结]',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-12 16:56:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/header.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 记录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i><span> 电影</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/plan"><i class="fa-fw fas fa-link"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/index_img/11.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Krolliaa</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 记录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书籍</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i><span> 电影</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/plan"><i class="fa-fw fas fa-link"></i><span> 计划</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">RabbitMQ Study [未完结]</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-08-12T08:45:54.288Z" title="发表于 2022-08-12 16:45:54">2022-08-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-08-12T08:56:57.609Z" title="更新于 2022-08-12 16:56:57">2022-08-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MessageQueue/">MessageQueue</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="消息中间件是什么？"><a href="#消息中间件是什么？" class="headerlink" title="消息中间件是什么？"></a>消息中间件是什么？</h1><p>消息队列就是消息中间件，消息很好理解你可以理解为信息，那中间件呢？中间件是提供软件和软件之间连接的软件，以便于软件各个部件之间的沟通。<strong>在咖啡店买咖啡这个例子中，微信就是消息中间件。发送方和接收方就是被消息中间件连接的</strong></p>
<h1 id="为什么要使用消息中间件呢？"><a href="#为什么要使用消息中间件呢？" class="headerlink" title="为什么要使用消息中间件呢？"></a>为什么要使用消息中间件呢？</h1><p><strong>同步直接调用 —&gt; 异步直接调用 —&gt; 消息中间件</strong></p>
<p>先来理解下什么是同步直接调用？请看下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/8c2fd1aed0bc4e4ab161b2b73f6f4ac0.png"></p>
<ul>
<li>可以看到同步直接调用的整个业务调用链非常长，这就会让用户等待的<strong>时间</strong>也变得很<strong>长</strong>。</li>
<li>而且<strong>中途</strong>只要有一个环节出现了<strong>故障</strong>就会导致<strong>整个业务瘫痪</strong>掉。这跟初中学习的串联没什么太大区别。</li>
<li>并且如果<strong>业务处于高峰期</strong>，此时某一个业务的处理能力比较<strong>拉跨</strong>的话就会导致<strong>整个系统都很拉跨</strong>。</li>
</ul>
<p>为了解决同步直接调用的这些处理时间长、局部故障导致全局故障，业务高峰期业务能力弱导致整个系统都弱的问题，就得到了<strong>异步直接调用</strong>的解决方案。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/a45dfa601fb34ceeb9a0fd6f795dbf16.png"></p>
<p>可以看到异步直接调用只要用户做了操作，就立马响应转换为“处理中”这么一种效果，新建一个异步线程，然后再去处理调用各个组件。异步直接调用解决了：</p>
<ol>
<li>业务调用链虽然还是挺长，但是解决了用户等待时间长的问题</li>
<li>部分组件故障会导致整个业务瘫痪，可能业务调用链里面的组件还是会发生故障，但我用户的操作返回的结果是没问题的</li>
<li>业务高峰期没有缓冲，这个也解决了，因为用户每次操作都会从线程池中拿一个新的异步线程</li>
</ol>
<p><strong><font color="red">但是异步直接调用这样又带来了新的问题：即如果业务高峰期非常非常爆满的话，那么线程池中的异步线程终究是不够用的，就会导致内存爆满。</font></strong></p>
<p>所以就需要一个能够处理高并发的，速度非常快的这么一种东西，它每次有任务一来我就自动快速的去完成这个任务，实现高效率操作。找来找去发现消息中间件是最最合适的。所以我们再将异步直接调用调用改造成了围绕消息中间件打造的这么一种模式：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/a21f573f87ff4c30b28ad8fd74b81cbe.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/32279f40627945efb760a3b81dc4380b.png"></p>
<p>通过这幅图我们就可以感受到消息中间件的妙处了：</p>
<ul>
<li>整个业务调用链很短，都是交给消息中间件去做，用户等待的时间也很短。</li>
<li>某个组件故障不会导致整个业务瘫痪</li>
<li>业务高峰期还有缓冲</li>
<li>业务高峰期时不会产生大量的异步线程【之前在异步直接调用可以发现异步线程非常的长，这种非常长时间的异步线程是很容被<code>KILL</code>掉的所以一定要防止这种长时的异步线程出现，比如非常长的<code>sleep</code>】</li>
</ul>
<h1 id="消息中间件的作用"><a href="#消息中间件的作用" class="headerlink" title="消息中间件的作用"></a>消息中间件的作用</h1><ul>
<li>异步处理</li>
<li>系统解耦</li>
<li>流量削峰和流控</li>
<li>消息广播：一个服务可以发送给多个服务，类似于微信的一人群发</li>
<li>消息收集：日志收集系统</li>
<li>最终一致性：对方什么时候处理是对方的事情但是存在于消息中间的消息一定会被对方处理掉【即时间问题但是一定可以处理】</li>
</ul>
<p>总结：<strong>消息中间件就是软件和软件之间发送消息的软件</strong>，消息中间件最大的作用就是<strong>异步消息</strong>、<strong>系统解耦</strong>，此外还有<strong>流量削峰</strong>、<strong>流量控制</strong>、<strong>消息收集</strong>、<strong>消息广播</strong>等特点。</p>
<h1 id="RabbitMQ高性能的原因"><a href="#RabbitMQ高性能的原因" class="headerlink" title="RabbitMQ高性能的原因"></a><code>RabbitMQ</code>高性能的原因</h1><ul>
<li>感受下安卓和苹果的速度，<code>RabbitMQ</code>是<code>erlang</code>语言开发的，一门专门为<strong>交换机软件开发诞生的编程语言</strong>。</li>
<li>适用于分布式系统，面向并发的。</li>
<li>而且<code>erlang</code>是虚拟机解释运行的可以跨平台部署</li>
<li><code>erlang</code>的进程间上下文切换效率远高于<code>C</code>语言</li>
<li>并且有着和<code>Socket</code>原生一样的延迟。</li>
</ul>
<p><code>RabbitMQ</code>饿了么美团中国银行工商银行这些互联网、金融行业有着广泛的应用。</p>
<h1 id="RabbitMQ的底层原理-—-AMQP协议"><a href="#RabbitMQ的底层原理-—-AMQP协议" class="headerlink" title="RabbitMQ的底层原理 — AMQP协议"></a><code>RabbitMQ</code>的底层原理 — <code>AMQP</code>协议</h1><ul>
<li>协议就是规范，而<code>AMQP</code>协议就是<code>RabbitMQ</code>的规范，规定了<code>RabbitMQ</code>的对外接口。</li>
<li>学习<code>RabbitMQ</code>本质就是学习<code>AMQP</code>协议。</li>
</ul>
<p>生产者生产消息然后贴上<code>Routing Key</code>路由键，这个路由键就相当于快递的收件地址<code>Queue</code>。这个快递到快递分拨中心的路程我们称其为<code>Connection</code>连接。因为去往快递分拨中心肯定不止一个快递，也许有好多好多个快递正在赶往快递分拨中心，这一条条到快递分拨中心的我们称其为<code>Channel</code>叫做一条条信道。然后快递就到快递分拨中心这里，快递分拨中心在消息中间件里头叫做<code>exchange</code>就是交换机的意思，到了快递分拨中心以后，快递分拨中心要将快递分拨中心跟收件地址进行绑定不然快递员不知道从哪里拿快递，然后快递员就可以快递到收件地址<code>Queue</code>可以是蜂巢，也可以是菜鸟驿站，然后消费者就可以从菜鸟驿站中取出快递拿来消费了。消费者拿快递的通道跟生产者的一样，去往队列的路有好多条，而且此时肯定同时也有好多消费者正在前往拿快递的路上，所以就会有多个信道，这些信道放到一块就组成了连接。【连接其实就是<code>TCP</code>连接】</p>
<p>整个快递系统起主导作用的就是消息中间件，这里称呼为<code>Message Broker</code>用于接收和分发快递。因为一个<code>Broker</code>快递系统忙不过来，所以这个大大的<code>Message Broker</code>就创建了好多<code>Virtual Host</code>，就是虚拟<code>Broker</code>，将多个单元隔开。</p>
<ul>
<li>整个快递系统最核心的组件就是：快递分拨中心 —&gt; <code>Exchange</code>交换机 —&gt; 它承担了非常重要的功能即<code>RabbitMQ</code>的核心功能 —&gt; <strong>路由转发</strong></li>
</ul>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><p>使用<code>draw.io</code>绘制<code>AMQP</code>协议结构图。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/9f0e5d464ed5452a89cf95226dd8ad50.png"></p>
<h1 id="RabbitMQ的心脏"><a href="#RabbitMQ的心脏" class="headerlink" title="RabbitMQ的心脏"></a><code>RabbitMQ</code>的心脏</h1><p><code>RabbitMQ</code>的整个核心就是<code>Exchange</code>交换机。</p>
<ul>
<li><p><code>Exchange</code>是<code>AMQP</code>协议和<code>RabbitMQ</code>的<strong>核心组件</strong>。</p>
</li>
<li><p><code>Exchange</code>的功能是根据<strong>路由键</strong>和<strong>绑定关系</strong>为消息提供路由，将消息转发至相应的队列。</p>
</li>
<li><p><code>Exchange</code>一共有四种类型：<code>Direct Topic Fanout Headers</code>，以前三种为主第四种使用地非常少。</p>
</li>
</ul>
<h2 id="Direct-Exchange【直连模式】"><a href="#Direct-Exchange【直连模式】" class="headerlink" title="Direct Exchange【直连模式】"></a><code>Direct Exchange</code>【直连模式】</h2><ul>
<li><p><code>Message</code>中的路由键<code>Routing Key</code>【快件地址】如果和绑定的菜鸟驿站<code>Binding Key</code>是一致的，那么【快递分拨中心】<code>Exchange</code>直接将<code>Message</code>发送到对应的队列【菜鸟驿站】<code>Queue</code>中。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/13c100680a1f479b85df8138fc797b52.png"></p>
</li>
</ul>
<h2 id="Fanout-Exchange【扇形模式】"><a href="#Fanout-Exchange【扇形模式】" class="headerlink" title="Fanout Exchange【扇形模式】"></a><code>Fanout Exchange</code>【扇形模式】</h2><ul>
<li><p>每个分发到<code>Fanout Exchange</code>的消息<code>Message</code>会将消息分发到所有绑定队列<code>Queue</code>上。也就是说会发送到所有这个交换机快递分拨中心绑定的消息队列上。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/3c5aae51c7b64cb7b6f51ee1ea5a2bbf.png"></p>
</li>
</ul>
<h2 id="Topic-Exchange【主题模式】"><a href="#Topic-Exchange【主题模式】" class="headerlink" title="Topic Exchange【主题模式】"></a><code>Topic Exchange</code>【主题模式】</h2><ul>
<li>根据<code>Routing Key</code>以及通配规则【可以跟<code>Binding Key + #</code>匹配任意单词】，如果没有通配规则则跟直连模式一样，同时还可以跟<code>*</code>匹配一个单词。</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong><font color="red">推荐：模拟的<code>RabbitMQ</code>网站 —&gt; <code>http://tryrabbitmq.com/</code></font></strong></p>
<ul>
<li><code>AMQP</code>协议直接决定了<code>RabbitMQ</code>的内部结构和外部行为</li>
<li>对于发送者来说，它只关系自己的消息有没有发送到特定的【快递分拨中心】交换机<code>Exchange</code>中</li>
<li>消息通过<code>Exchange</code>路由后，到达具体的消息队列</li>
<li>消费者将消息从监听的队列中取走</li>
</ul>
<p>站在<code>Exchange</code>交换机这个快递分拨中心的角度上来，我只关心要发送的快递要发到哪里去，来寄快递的人告诉我这个快递要寄到哪里去，然后我就让指定的快递员按指定快递路线去发就可以了。所以<strong>路由键</strong><code>Routing Key</code>就是告诉快递分拨中心我要发到哪里去，而<strong>绑定关系</strong><code>Binding Key</code>就是快递分拨中心指定的快递线路。【<strong>简而言之交换机<code>Exchange</code>：不关心怎么来，只关心到哪去</strong>】</p>
<p><strong>所以说交换机<code>Exchange</code>的作用就是：<font color="red">根据路由键和绑定关系为消息提供路由，将消息转发到相应的队列中。</font></strong></p>
<h2 id="作业-1"><a href="#作业-1" class="headerlink" title="作业"></a>作业</h2><p>作业：在<code>tryrabbitmq.com</code>网站中，搭建<code>Direct Fanout Topic</code>三种模式的发布订阅模型。</p>
<p>第一种：<code>Direct</code>直连模式 —&gt; 张三和李四购买了咖啡，直连模式会发送到<code>1号丰巢快递柜</code>，张三李四轮询消费。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/bbbbb550e8c84ceb9bb2ee3bdfc014d2.png"></p>
<p>第二种：<code>Fanout</code>广播模式 —&gt; 奶茶店老板豪气十足，每个人都送<code>1</code>杯饮料，美团乐坏了。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/27e9a634acda43fa93d69c003fe015b6.png"></p>
<p>第三种：<code>Topic</code>主题模式 —&gt;</p>
<ul>
<li>张三无论热的冰的咖啡都可以，糖分无所谓，老板做啥他喝啥，所以张三的绑定关系绑定了个<code>*.coffee</code></li>
<li>李四只喝热咖啡，糖分无所谓，所以李四的绑定关系绑定了个<code>hot.coffee</code></li>
<li>王五只喝冰咖啡，糖分无所谓，所以李四的绑定关系绑定了个<code>cold.coffee</code></li>
</ul>
<p>奶茶店老板不定时送咖啡，可以看到当老板送热咖啡的时候，张三和李四可以收到，当送冰咖啡的时候张三和王五可以收到，看来不挑食可以得到的更多哈哈</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/b62fac4d47f14594831f9f3c55d14090.png"></p>
<p>某天李四想减肥了，所以不想喝甜的咖啡了，于是李四喝咖啡的标准就是：<code>hot.unsweet.coffee</code>。</p>
<p>王五这个人呢就很喜欢吃甜食她也不介意，但是她还是想喝冰的，于是她喝咖啡的标准就成了：<code>cold.sweet.coffee</code></p>
<p>张三这个人还是一贯的不挑食不介意，冰的热的还是甜的她都可以，她就喜欢喝咖啡，没别的要求哈哈</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/b3ef7e8a0e894b9ea81d4e66f1e8615e.png"></p>
<p>这里张三<code>#.coffee</code>，这里的<code>#</code>只有在主题模式才有，表示匹配任意多个单词。</p>
<ul>
<li>当有冷的甜的咖啡的时候张三跟王五可以收到。</li>
<li>当有热的苦的咖啡的时候张三跟李四可以收到。</li>
</ul>
<h1 id="RabbitMQ快速安装"><a href="#RabbitMQ快速安装" class="headerlink" title="RabbitMQ快速安装"></a><code>RabbitMQ</code>快速安装</h1><p><code>Windows</code>：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.rabbitmq.com/which-erlang.html">RabbitMQ Erlang Version Requirements — RabbitMQ</a>查找版本映射关系</li>
<li><a target="_blank" rel="noopener" href="https://www.erlang.org/">Index - Erlang&#x2F;OTP</a>下载安装<code>Erlang</code></li>
<li><a target="_blank" rel="noopener" href="https://www.rabbitmq.com/install-windows.html">Installing on Windows — RabbitMQ</a>下载安装<code>RabbitMQ</code></li>
</ul>
<p>配置环境变量，然后直接在<code>cmd</code>中输入<code>rabbitmq-server</code>即可 —&gt; 这里的版本是<code>3.10.7</code>如果是老一点的版本，可能需要启动插件才可以在网页版中查看<code>RabbitMQ</code>消息队列。 —&gt; <code>http://localhost:15672</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rabbitmq-plugins --help</span><br><span class="line">rabbitmq-plugins list </span><br><span class="line">rabbitmq-plugins rabbitmq_management</span><br></pre></td></tr></table></figure>

<p>该网页有六大模块：<strong>概览、连接、信道、交换机、队列、管理</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/7f69607850f14ac08da133260c3cbb28.png"></p>
<p>在<code>RabbitMQ</code>里头给予了一个默认的交换机即：<code>AMQP default</code>，它本质也是直连模式但是简化了直连模式的<code>Binding Key</code>，它默认<code>Binding Key</code>就是队列名。所以在这个直连模式下，你要实现发布订阅，你的路由键直接跟队列名同名即可。</p>
<h2 id="作业-2"><a href="#作业-2" class="headerlink" title="作业"></a>作业</h2><p>使用<code>RabbitMQ</code>管控台配置：直连模式、广播模式、主题模式</p>
<ul>
<li><p>我们创建三种类型的交换机，交换机是负责给通过路由键和绑定关系给消息提供路由的，分别为：美团直连模式、美团广播模式、美团话题模式。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/380795f57fc84014ab8fd77642641330.png"></p>
</li>
<li><p>然后创建三个队列，队列存储的是消息内容，等待消费者的消费，分别为：1号丰巢快递柜、2号丰巢快递柜、3号丰巢快递柜。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/3792179435f94af2bd6a52af5a81e2da.png"></p>
</li>
</ul>
<ol>
<li><p>测试直连模式：</p>
<p>针对三个队列绑定关系为：<code>hot.coffee *.coffee cold.coffee</code></p>
<p>发送消息的路由键为：<code>hot.coffee cold.coffee</code>，发送，观察队列情况：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/3792179435f94af2bd6a52af5a81e2da.png"></p>
<p>可以看到在直连模式下，消息发送到哪个队列，路由键跟绑定关系是绝对紧密相连的。</p>
</li>
<li><p>测试广播模式：</p>
<p>针对三个队列绑定关系为：<code>hot.coffee *.coffee cold.coffee</code></p>
<p>只发送1个消息，路由键为：<code>hot.coffee</code>，发送，观察队列情况：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/84e58285faff41ab803dc36ad1bf9302.png"></p>
<p>可以看到虽然只发送了一个消息而且路由键为<code>hot.coffee</code>而只有1号丰巢快递柜的绑定关系跟这个路由键相匹配，但是所有队列都收到了这个消息，这就是广播模式的发布订阅模型。</p>
</li>
<li><p>测试话题模式：</p>
<p>针对三个队列绑定关系为：<code>hot.coffee *.coffee cold.coffee</code></p>
<p>只发送1个消息，路由键为：<code>hot.coffee</code>，发送，观察队列情况：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/2418516c68c04f088c1efe7e91c069d7.png"></p>
<p>可以看到1号跟2号收到了，但是3号没有收到，奇怪，2号的绑定关系不是<code>*.coffee</code>吗？这就是话题模式的精髓所在，它可以通过通配符的方式匹配上路由从而使队列接收到消息。</p>
</li>
</ol>
<h1 id="RabbitMQ命令行工具"><a href="#RabbitMQ命令行工具" class="headerlink" title="RabbitMQ命令行工具"></a><code>RabbitMQ</code>命令行工具</h1><ul>
<li>想看什么就<code>List</code>什么</li>
<li>想清空什么就<code>Purge</code>什么</li>
<li>想删除什么就<code>Delete</code>什么</li>
<li>一切问题记得使用<code>--help</code></li>
</ul>
<p>查看相关：	</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查看状态：rabbitmqctl status</span><br><span class="line">查看连接：rabbitmqctl list_connections</span><br><span class="line">查看信道：rabbitmqctl list_channels</span><br><span class="line">查看交换机：rabbitmqctl list_exchanges</span><br><span class="line">查看绑定：rabbitmqctl list_bindings</span><br><span class="line">查看队列：rabbitmqctl list_queues</span><br><span class="line">查看消费者：rabbitmqctl list_consumers</span><br></pre></td></tr></table></figure>

<p>队列相关：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看队列：rabbitmqctl list_queues</span><br><span class="line">删除队列：rabbitmqctl delete_queue</span><br><span class="line">清空队列：rabbitmqctl purge_queue</span><br></pre></td></tr></table></figure>

<p>用户相关：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">新建用户：rabbitmqctl add_user</span><br><span class="line">修改用户密码：rabbitmqctl change_password</span><br><span class="line">删除用户：rabbitmqctl delete_user</span><br><span class="line">查看用户：rabbitmqctl list_users</span><br><span class="line">设置用户角色：rabbitmqctl set_user_tags</span><br></pre></td></tr></table></figure>

<p>应用相关：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">启动应用：rabbitmqctl start_app</span><br><span class="line">关闭应用保留（暂停）Erlang虚拟机：rabbitmqctl stop_app</span><br><span class="line">关闭应用并关闭Erlang虚拟机：rabbitmqctl stop</span><br></pre></td></tr></table></figure>

<p>集群相关：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">加入集群：rabbitmqctl join_cluster</span><br><span class="line">离开集群：rabbitmqctl reset</span><br></pre></td></tr></table></figure>

<p>镜像队列相关：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">设置镜像队列：rabbitmqctl sync_queue</span><br><span class="line">取消镜像队列：rabbitmqctl cancel_sync_queue</span><br></pre></td></tr></table></figure>

<h1 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h1><ul>
<li><p><code>RabbitMQ</code>高性能的原因：</p>
<ol>
<li><p>从内看：<code>Erlang</code>进程间上下文切换的效率远高于<code>C Java</code>，使得<code>RabbitMQ</code>的并发能力非常强悍</p>
</li>
<li><p>从外看：网络性能有着跟原生<code>Socket</code>一样的延迟，使得<code>RabbitMQ</code>网络<code>IO</code>性能极高</p>
</li>
</ol>
</li>
<li><p><code>RabbitMQ</code>的底层协议<code>AMQP</code>协议</p>
</li>
<li><p><code>RabbitMQ</code>的核心<code>Exchange</code></p>
</li>
</ul>
<h1 id="RabbitMQ消息交换的关键是什么？"><a href="#RabbitMQ消息交换的关键是什么？" class="headerlink" title="RabbitMQ消息交换的关键是什么？"></a><code>RabbitMQ</code>消息交换的关键是什么？</h1><p><strong>使用<code>RabbitMQ</code>本质上就是在使用<code>AMQP</code>协议</strong>，<code>AMQP</code>协议定义了<code>RabbitMQ</code>的内部结构和外部行为。</p>
<p><strong>在<code>RabbitMQ</code>中其消息转换流程如下：</strong></p>
<ul>
<li>发送者不能将消息直接发送到队列中，而需要发送给交换机</li>
<li>交换机通过路由键和绑定关系给消息提供路由，将消息转发到指定队列</li>
<li>消费者从队列中取走消息</li>
</ul>
<p><strong>合理的交换机和队列设置：</strong></p>
<ul>
<li>交换机的数量不能过多，一般来说同一个业务，或者同一类业务使用同一个交换机。</li>
<li>合理设置队列数量，一般来说一个微服务监听一个队列或者一个微服务的一个业务监听一个队列。</li>
<li>合理配置交换机类型，是同<code>Topic</code>模式的时候仔细设置绑定关系<code>Binding Key</code>以及路由键<code>Routing Key</code></li>
</ul>
<p><strong>尽量使用自动化配置：</strong></p>
<ul>
<li>将创建交换机、队列的操作固化在应用代码中，这样就可以更高效且不易出错免去了复杂的运维操作</li>
<li>一般来说，交换机由双方同时声明，队列由接收方声明并配置绑定关系</li>
<li>交换机&#x2F;队列的参数一定要由双方开发团队确认，否则重复声明时若参数不一致会导致生命失败</li>
</ul>
<p>所以关键就是：<strong>根据<code>AMQP</code>协议合理配置交换机和队列并且尽可能的时自动化部署交换机和队列。</strong></p>
<p>包括：交换机类型、交换机数量、队列数量、双方同时声明交换机跟队列</p>
<h2 id="作业-3"><a href="#作业-3" class="headerlink" title="作业"></a>作业</h2><p><strong>为什么<code>AMQP</code>要设计出<code>Exchange</code>消息流转机制呢？</strong></p>
<p>我是这样想的：</p>
<ol>
<li>设计出交换机消息流转机制，生产者跟消费者就不用关心转发的事情了，生产者只负责消费，消费者只负责消费，而有关消息转发的事情就交给<code>Exchange</code>来做，这样做可以很大程度上使<strong>系统解耦</strong>。</li>
<li>同时生产者生产完毕之后就可以不管消费者有没有去消费了，那么生产者的任务就完成了，它就可以继续干他的事情了，这就产生了<strong>异步消息处理</strong>的好处。大大省去了等待时间。</li>
<li>然后就是关于生产者生产的消息要到哪个地方【这里叫做队列】去被哪个消费者所消费，如果没有<code>Exchange</code>交换机去流转消息，那这些工作总得有人去做的，此时当然就是生产者来做了，这样肯定就会降低生产者的效率，而有了交换机可以去做流转，还可以做到<strong>消息广播</strong>跟<strong>消息收集</strong>，将消息分配到符合规则条件的队列中，并且还能做一些记录日志的工作。</li>
<li>最后就是关于流量的问题了，生产者一直负责生产，消费者一直负责消费，假设一下现在突然有了非常非常哒的流量，那么势必生产者会在一瞬间生产大量的消息，此时消费者的消费能力可能是挡不住的，作为生产者和消费者的中间着<code>Exchange</code>此时就可以发挥巨大的作用了。它可以针对这巨大的流量做<strong>流量削峰</strong>跟<strong>流量控制</strong>。</li>
</ol>
<p>所以我猜<code>AMQP</code>正是综合以上种种优点才设计出了<code>Exchange</code>消息流转机制，它有用：**<font color="red">系统解耦、异步处理、流量削峰、流量控制、消息广播、消息收集</font>**等等好处。</p>
<h1 id="什么是微服务架构？"><a href="#什么是微服务架构？" class="headerlink" title="什么是微服务架构？"></a>什么是微服务架构？</h1><p>微服务架构就是将应用程序构建为松耦合可以独立部署的一组服务。</p>
<ul>
<li>所谓服务就是一个单一的，可以独立部署的软件组件，实现了一些有用的功能。</li>
<li>所谓松耦合就是封装了服务的实现细节，要使用时直接通过<code>API</code>调用接口。</li>
</ul>
<p>那么如何将一个应用程序拆分成一个个的微服务呢？</p>
<ul>
<li>拆分方法一：你可以根据<strong>系统操作</strong>进行微服务拆分，比如查询服务拆成一块，添加服务拆成一块</li>
<li>拆分方法二：你可以根据<strong>业务能力</strong>进行微服务拆分，比如订单相关、骑手相关、结算相关等。<strong>【推荐】</strong></li>
<li>拆分方法三：你可以根据<strong>子域</strong>进行微服务拆分</li>
</ul>
<h1 id="实战使用RabbitMQ"><a href="#实战使用RabbitMQ" class="headerlink" title="实战使用RabbitMQ"></a>实战使用<code>RabbitMQ</code></h1><h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><ul>
<li>一个外卖后端系统用户可以在线下单外卖</li>
<li>用户在线下单后可以实时查询订单进度</li>
<li>系统可以承受短时间内大量并发请求【饭点时间请求会突然变大】</li>
</ul>
<h2 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h2><ul>
<li><p>使用微服务系统，组件之间充分解耦</p>
<p>【你下单 ———-&gt; 商家接单 ———-&gt; 骑手前往、拿外卖、送外卖 ———-&gt; 结算 ———-&gt; 积分】</p>
<ul>
<li><p>订单的获取和履行 ———-&gt; 订单微服务</p>
</li>
<li><p>供应商和产品管理 ———-&gt; 商家微服务</p>
</li>
<li><p>送餐、骑手管理 ———-&gt; 骑手微服务</p>
</li>
<li><p>记账和结算 ———-&gt; 结算微服务</p>
</li>
<li><p>积分管理 ———-&gt; 积分微服务</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/77f533ede7964adaa185dcb7c1d66267.png"></p>
</li>
</ul>
</li>
<li><p>使用消息中间件，解耦业务逻辑</p>
</li>
<li><p>使用数据库，持久化业务数据</p>
</li>
</ul>
<p>整个业务流程如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/32279f40627945efb760a3b81dc4380b.png"></p>
<h2 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h2><ul>
<li>新建订单接口</li>
<li>查询订单接口</li>
</ul>
<h2 id="微服务数据库相关设计"><a href="#微服务数据库相关设计" class="headerlink" title="微服务数据库相关设计"></a>微服务数据库相关设计</h2><ul>
<li>每个微服务使用自己的数据库&#x2F;数据表</li>
<li>不要使用共享数据进行通信</li>
<li>不要使用外键，对于数据量非常少的表慎用索引【非常消耗资源】</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/4bf660d106624bb0ae5a984464501e1b.png"></p>
<p><code>Sql</code>语句如下【例子】：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> `deliveryman` (</span><br><span class="line">	`id` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT `骑手ID`,</span><br><span class="line">    `name` <span class="type">VARCHAR</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT `名称`,</span><br><span class="line">    `status` <span class="type">VARCHAR</span>(<span class="number">36</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT `状态`,</span><br><span class="line">    `<span class="type">date</span>` DATETIME <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT `时间`</span><br><span class="line">)ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span><span class="operator">=</span>utf<span class="number">-8</span>;</span><br></pre></td></tr></table></figure>

<p><strong>搭建订单数据库：<code>order_detail.sql</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `order_detail`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `order_detail`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">  `status` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">  `address` <span class="type">varchar</span>(<span class="number">64</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单地址&#x27;</span>,</span><br><span class="line">  `account_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户id&#x27;</span>,</span><br><span class="line">  `product_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;产品id&#x27;</span>,</span><br><span class="line">  `deliveryman_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;骑手id&#x27;</span>,</span><br><span class="line">  `settlement_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;结算id&#x27;</span>,</span><br><span class="line">  `reward_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;积分奖励id&#x27;</span>,</span><br><span class="line">  `price` <span class="type">decimal</span>(<span class="number">10</span>, <span class="number">2</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;价格&#x27;</span>,</span><br><span class="line">  `<span class="type">date</span>` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">403</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>搭建商家数据库：<code>restaurant.sql</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `restaurant`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `restaurant`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;餐厅id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">  `address` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;地址&#x27;</span>,</span><br><span class="line">  `status` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">  `settlement_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;结算id&#x27;</span>,</span><br><span class="line">  `<span class="type">date</span>` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `restaurant` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;qeqwe&#x27;</span>, <span class="string">&#x27;2weqe&#x27;</span>, <span class="string">&#x27;OPEN&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;2020-05-06 19:19:39&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>搭建产品数据库：<code>product.sql</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `product`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `product`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;产品id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">  `price` <span class="type">decimal</span>(<span class="number">9</span>, <span class="number">2</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;单价&#x27;</span>,</span><br><span class="line">  `restaurant_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;地址&#x27;</span>,</span><br><span class="line">  `status` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">  `<span class="type">date</span>` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `product` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;eqwe&#x27;</span>, <span class="number">23.25</span>, <span class="number">1</span>, <span class="string">&#x27;AVALIABLE&#x27;</span>, <span class="string">&#x27;2020-05-06 19:19:04&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>搭建骑手数据库：<code>deliveryman.sql</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `deliveryman`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `deliveryman`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;骑手id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">  `status` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">  `<span class="type">date</span>` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `deliveryman` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;wangxiaoer&#x27;</span>, <span class="string">&#x27;AVALIABLE&#x27;</span>, <span class="string">&#x27;2020-06-10 20:30:17&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>搭建结算数据库：<code>settlement.sql</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `settlement`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `settlement`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;结算id&#x27;</span>,</span><br><span class="line">  `order_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">  `transaction_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;交易id&#x27;</span>,</span><br><span class="line">  `amount` <span class="type">decimal</span>(<span class="number">9</span>, <span class="number">2</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;金额&#x27;</span>,</span><br><span class="line">  `status` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">  `<span class="type">date</span>` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1168</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>搭建积分数据库：<code>reward.sql</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `reward`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `reward`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;奖励id&#x27;</span>,</span><br><span class="line">  `order_id` <span class="type">int</span>(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;订单id&#x27;</span>,</span><br><span class="line">  `amount` <span class="type">decimal</span>(<span class="number">9</span>, <span class="number">2</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;积分量&#x27;</span>,</span><br><span class="line">  `status` <span class="type">varchar</span>(<span class="number">36</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态&#x27;</span>,</span><br><span class="line">  `<span class="type">date</span>` datetime(<span class="number">0</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">8</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><p><code>pom.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.kk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>RabbitMQStudy<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>RabbitMQStudy<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>RabbitMQStudy<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="开发订单微服务"><a href="#开发订单微服务" class="headerlink" title="开发订单微服务"></a>开发订单微服务</h2><p>想想为什么要使用<code>Direct</code>模式呢？因为餐厅搞来的一个订单只能被一个骑手接单所以需要使用<code>Direct</code>模式。</p>
<p>首先肯定需要先做订单微服务，然后再做商家微服务以及骑手微服务。</p>
<p>配置连接数据库：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/food?useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p><strong>开发实体类 —&gt; 订单详情：<code>food.orderservicemanager.entity.OrderDetail</code></strong></p>
<p>【注意价格的数据类型要使用：<code>BigDecimal</code>，因为浮点数会有精度损失】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.food.orderservicemanager.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.enummeration.OrderStatus;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单详情实体类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDetail</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单 ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单状态</span></span><br><span class="line"><span class="comment">     * 使用枚举类获取订单状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> OrderStatus status;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 配送地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户 ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer accountId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商品 ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer productId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 已分配骑手 ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer deliverymanId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 结算 ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer settlementId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 积分 ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer rewardId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 价格</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单日期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>开发订单详情状态枚举类：订单创建中  商家确认 骑手确认 结算确认 订单创建完成 订单创建失败</strong></p>
<p><code>com.food.orderservicemanager.enummeration.OrderStatus</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.food.orderservicemanager.enummeration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">OrderStatus</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单创建中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ORDER_CREATING,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单创建完成</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ORDER_CREATED,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单创建失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ORDER_FAILED,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 商家确认订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    RESTAURANT_CONFIRMED,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 骑手确认订单</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    DELIVERYMAN_CONFIRMED,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 订单完成结算确认</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    SETTLEMENT_CONFIRMED</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查看业务流程：可以发现需要向商家、骑手、结算、积分发送消息，那要发送首先你得有消息，所以<strong>创建消息实体类 —&gt; 数据传输类<code>DataTransformObject 简称 DTO</code>：<code>dto.OrderMessageDTO</code></strong><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img-blog.csdnimg.cn/32279f40627945efb760a3b81dc4380b.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.food.orderservicemanager.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.enummeration.OrderStatus;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderMessageDTO</span> &#123;</span><br><span class="line">    <span class="comment">//包括订单ID 用户ID 商家ID 产品ID 骑手ID 结算ID 积分ID 订单价格 状态积分数量 确认状态</span></span><br><span class="line">    <span class="keyword">private</span> Integer orderId;</span><br><span class="line">    <span class="keyword">private</span> OrderStatus orderStatus;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> Integer deliverymanId;</span><br><span class="line">    <span class="keyword">private</span> Integer productId;</span><br><span class="line">    <span class="keyword">private</span> Integer accountId;</span><br><span class="line">    <span class="keyword">private</span> Integer settlementId;</span><br><span class="line">    <span class="keyword">private</span> Integer rewardId;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal rewardAmount;</span><br><span class="line">    <span class="keyword">private</span> Boolean confirmed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了订单详情跟消息，我们首先得要做的就是获取<strong>前端发过来的订单相关数据</strong>，否则我们无法接着往下走，从前端可以获取到用户<code>ID</code>，配送地址和产品<code>ID</code>：</p>
<p><code>vo.OrderCreateVO</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.food.orderservicemanager.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderCreateVO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer accountId;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Integer productId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开发<code>Dao</code>层：<code>dao.OrderDetailDao</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.food.orderservicemanager.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.entity.OrderDetail;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderDetailDao</span> &#123;</span><br><span class="line">    <span class="comment">//创建订单</span></span><br><span class="line">    <span class="meta">@Insert(&quot;INSERT INTO order_detail (status, address, account_id, product_id, deliveryman_id, settlement_id, reward_id, price, date) VALUES(#&#123;status&#125;, #&#123;address&#125;, #&#123;accountId&#125;, #&#123;productId&#125;, #&#123;deliverymanId&#125;, #&#123;settlementId&#125;, #&#123;rewardId&#125;, #&#123;price&#125;, #&#123;date&#125;)&quot;)</span></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(OrderDetail orderDetail)</span>;</span><br><span class="line">    <span class="comment">//更新订单</span></span><br><span class="line">    <span class="meta">@Update(&quot;update order_detail set status =#&#123;status&#125;, address =#&#123;address&#125;, account_id =#&#123;accountId&#125;, product_id =#&#123;productId&#125;, deliveryman_id =#&#123;deliverymanId&#125;, settlement_id =#&#123;settlementId&#125;, reward_id =#&#123;rewardId&#125;, price =#&#123;price&#125;, date =#&#123;date&#125; where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(OrderDetail orderDetail)</span>;</span><br><span class="line">    <span class="comment">//查询订单</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT id,status,address,account_id accountId, product_id productId,deliveryman_id deliverymanId, settlement_id settlementId,reward_id rewardId,price, date FROM order_detail WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> OrderDetail <span class="title function_">selectOrderDetail</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开发服务层：定义交换机、队列并绑定<code>OrderDetailMessageService.java</code>【学习如何使用硬编码的方式声明交换机、队列并发送消息】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.food.orderservicemanager.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDetailMessageService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleMessage</span><span class="params">()</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">             <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel()) &#123;</span><br><span class="line">            <span class="comment">//定义商家微服务交换机：交换机名称，交换机类型，是否持久化，是否在没有绑定队列的时候自动删除，参数</span></span><br><span class="line">            channel.exchangeDeclare(<span class="string">&quot;exchange.order.restaurant&quot;</span>, BuiltinExchangeType.DIRECT, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">            <span class="comment">//定义骑手微服务交换机：交换机名称，交换机类型，是否持久化，是否在没有绑定队列的时候自动删除，参数</span></span><br><span class="line">            channel.exchangeDeclare(<span class="string">&quot;exchange.order.deliveryman&quot;</span>, BuiltinExchangeType.DIRECT, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">            <span class="comment">//定义商家微服务和骑手微服务的队列：队列名称，是否持久化，是否只被一个连接持有，是否自动删除，参数</span></span><br><span class="line">            <span class="comment">//为什么这里可以使用同一个队列呢？因为只要更改不同的 Routing Key 就可以指定不同的消费者消费</span></span><br><span class="line">            channel.queueDeclare(<span class="string">&quot;queue.order&quot;</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">            <span class="comment">//绑定交换机跟队列</span></span><br><span class="line">            channel.queueBind(<span class="string">&quot;queue.order&quot;</span>, <span class="string">&quot;exchange.order.restaurant&quot;</span>, <span class="string">&quot;key.order&quot;</span>);</span><br><span class="line">            channel.queueBind(<span class="string">&quot;queue.order&quot;</span>, <span class="string">&quot;exchange.order.deliveryman&quot;</span>, <span class="string">&quot;key.order&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">OrderDetailMessageService</span> <span class="variable">orderDetailMessageService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetailMessageService</span>();</span><br><span class="line">        orderDetailMessageService.handleMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>开发服务层<code>OrderDetailService</code>，向商家微服务发送消息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.food.orderservicemanager.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.dao.OrderDetailDao;</span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.dto.OrderMessageDTO;</span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.entity.OrderDetail;</span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.enummeration.OrderStatus;</span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.vo.OrderCreateVO;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Channel;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.Connection;</span><br><span class="line"><span class="keyword">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDetailService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderDetailDao orderDetailDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ObjectMapper objectMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建订单：获取前端传递过来的订单信息，封装成实体类然后通过 MyBatis 将其保存至数据库</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(OrderCreateVO orderCreateVO)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="type">OrderDetail</span> <span class="variable">orderDetail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">        orderDetail.setProductId(orderCreateVO.getProductId());</span><br><span class="line">        orderDetail.setAccountId(orderCreateVO.getAccountId());</span><br><span class="line">        orderDetail.setAddress(orderCreateVO.getAddress());</span><br><span class="line">        orderDetail.setStatus(OrderStatus.ORDER_CREATING);</span><br><span class="line">        orderDetail.setDate(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        orderDetailDao.insert(orderDetail);</span><br><span class="line">        <span class="comment">//将订单消息发送给商家：需要知道订单ID，产品ID，用户ID</span></span><br><span class="line">        <span class="type">OrderMessageDTO</span> <span class="variable">orderMessageDTO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderMessageDTO</span>();</span><br><span class="line">        orderMessageDTO.setOrderId(orderDetail.getId());</span><br><span class="line">        orderMessageDTO.setProductId(orderDetail.getProductId());</span><br><span class="line">        orderMessageDTO.setAccountId(orderDetail.getAccountId());</span><br><span class="line">        <span class="comment">//发送消息 ---&gt; 需要将对象转换成字符串格式 ---&gt; 然后转成字节推送到消息队列中</span></span><br><span class="line">        <span class="type">ConnectionFactory</span> <span class="variable">connectionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConnectionFactory</span>();</span><br><span class="line">        connectionFactory.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> connectionFactory.newConnection();</span><br><span class="line">             <span class="type">Channel</span> <span class="variable">channel</span> <span class="operator">=</span> connection.createChannel()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">messageToSend</span> <span class="operator">=</span> objectMapper.writeValueAsString(orderMessageDTO);</span><br><span class="line">            channel.basicPublish(<span class="string">&quot;exchange.order.restaurant&quot;</span>, <span class="string">&quot;key.restaurant&quot;</span>, <span class="literal">null</span>, messageToSend.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Controller</code>控制层：使用<code>Slf4j</code>打印日志（<code>lombok</code>）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.food.orderservicemanager.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.service.OrderDetailService;</span><br><span class="line"><span class="keyword">import</span> com.food.orderservicemanager.vo.OrderCreateVO;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeoutException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderDetailController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderDetailService orderDetailService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createOrder</span><span class="params">(OrderCreateVO orderCreateVO)</span> <span class="keyword">throws</span> IOException, TimeoutException &#123;</span><br><span class="line">        <span class="comment">//使用 SLF4J 打印日志 ---&gt; lombok</span></span><br><span class="line">        log.info(<span class="string">&quot;createOrder:orderCreateVO:&#123;&#125;&quot;</span>, orderCreateVO);</span><br><span class="line">        orderDetailService.createOrder(orderCreateVO);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>













<ul>
<li><p>商家：<code>food.deliverymanservicemanager.entity.Restaurant</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>
</li>
<li><p>产品：<code>food.deliverymanservicemanager.entity.Product</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>
</li>
<li><p>骑手：<code>food.deliverymanservicemanager.entity.Deliveryman</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>
</li>
<li><p>结算：<code>food.deliverymanservicemanager.entity.Settlement</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>
</li>
<li><p>积分：<code>food.deliverymanservicemanager.entity.Reward</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">douban:</span><br><span class="line">  user: sz1010</span><br><span class="line">  builtin: <span class="literal">true</span></span><br><span class="line">  book:</span><br><span class="line">    title: <span class="string">&#x27;Books&#x27;</span></span><br><span class="line">    quote: <span class="string">&#x27;书籍是人类进步的阶梯 ——— 高尔基&#x27;</span></span><br><span class="line">  movie:</span><br><span class="line">    title: <span class="string">&#x27;Movies&#x27;</span></span><br><span class="line">    quote: <span class="string">&#x27;不要说不可能，没有什么不可能。———《教父》&#x27;</span></span><br><span class="line">  timeout: <span class="number">10000</span></span><br></pre></td></tr></table></figure></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Krolliaa</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/08/12/RabbitMQStudy/">http://example.com/2022/08/12/RabbitMQStudy/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Krolliaa</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a><a class="post-meta__tags" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/">消息队列</a></div><div class="post_share"><div class="social-share" data-image="/img/index_img/11.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/08/12/SpringStudyStudy/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/index_img/17.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Spring Study</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/12/NginxStudy/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/index_img/17.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Nginx Study</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/header.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Krolliaa</div><div class="author-info__description">俱往矣，数风流人物，还看今朝！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">37</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/krolliaa"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">消息中间件是什么？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E5%91%A2%EF%BC%9F"><span class="toc-text">为什么要使用消息中间件呢？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text">消息中间件的作用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RabbitMQ%E9%AB%98%E6%80%A7%E8%83%BD%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-text">RabbitMQ高性能的原因</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RabbitMQ%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86-%E2%80%94-AMQP%E5%8D%8F%E8%AE%AE"><span class="toc-text">RabbitMQ的底层原理 — AMQP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A"><span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RabbitMQ%E7%9A%84%E5%BF%83%E8%84%8F"><span class="toc-text">RabbitMQ的心脏</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Direct-Exchange%E3%80%90%E7%9B%B4%E8%BF%9E%E6%A8%A1%E5%BC%8F%E3%80%91"><span class="toc-text">Direct Exchange【直连模式】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fanout-Exchange%E3%80%90%E6%89%87%E5%BD%A2%E6%A8%A1%E5%BC%8F%E3%80%91"><span class="toc-text">Fanout Exchange【扇形模式】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Topic-Exchange%E3%80%90%E4%B8%BB%E9%A2%98%E6%A8%A1%E5%BC%8F%E3%80%91"><span class="toc-text">Topic Exchange【主题模式】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-1"><span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RabbitMQ%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85"><span class="toc-text">RabbitMQ快速安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-2"><span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RabbitMQ%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7"><span class="toc-text">RabbitMQ命令行工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RabbitMQ%E6%B6%88%E6%81%AF%E4%BA%A4%E6%8D%A2%E7%9A%84%E5%85%B3%E9%94%AE%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">RabbitMQ消息交换的关键是什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A-3"><span class="toc-text">作业</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%9F"><span class="toc-text">什么是微服务架构？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E4%BD%BF%E7%94%A8RabbitMQ"><span class="toc-text">实战使用RabbitMQ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="toc-text">需求分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1"><span class="toc-text">架构设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1"><span class="toc-text">接口设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E8%AE%BE%E8%AE%A1"><span class="toc-text">微服务数据库相关设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E7%8E%AF%E5%A2%83"><span class="toc-text">搭建环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E8%AE%A2%E5%8D%95%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">开发订单微服务</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/13/ESLint/" title="ESLint"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/index_img/16.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ESLint"/></a><div class="content"><a class="title" href="/2022/09/13/ESLint/" title="ESLint">ESLint</a><time datetime="2022-09-13T09:22:19.261Z" title="发表于 2022-09-13 17:22:19">2022-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/13/Vue-Element-Admin/" title="vue-element-admin"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/index_img/11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vue-element-admin"/></a><div class="content"><a class="title" href="/2022/09/13/Vue-Element-Admin/" title="vue-element-admin">vue-element-admin</a><time datetime="2022-09-13T09:21:59.812Z" title="发表于 2022-09-13 17:21:59">2022-09-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/13/Webpack/" title="WebPack"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/index_img/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WebPack"/></a><div class="content"><a class="title" href="/2022/09/13/Webpack/" title="WebPack">WebPack</a><time datetime="2022-09-13T06:50:47.598Z" title="发表于 2022-09-13 14:50:47">2022-09-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/index_img/11.jpg')"><div id="footer-wrap"><div class="copyright">&copy;1984 - 2022 By Krolliaa</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div></div></body></html>